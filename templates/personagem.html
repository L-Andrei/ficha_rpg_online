<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <meta charset="utf-8">
        <title>Personagem</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" href="{{url_for('static',filename='css/personagem.css')}}">
    </head>
    <body>
        <header>
        <h1>Ficha Do Personagem</h1>
        </header>
        <br><br>
        <Section id="ficha">
          <div id="status" style="border:1px solid white;">
              <p id="nome"></p>
              <p class='status_text'></p>
              <p id="vida"></p>
              <div class="custom-progress">
                <progress id="vida_atual" value="15" max="11"></progress>
              </div>  
              <br>
              <p class="status_text"></p>
              <p id="san"></p>
              <div class="custom-progress">
                <progress id="san_atual" value="19" max="20"></progress>
              </div>
              <br> 
              <p class="status_text"></p>
              <p id="pe"></p>
              <div class="custom-progress">
                <progress id="pe_atual" value="5" max="7"></progress>
              </div>
              <br><br>
              <button id='myBtn'>Atualização de status</button>
              <br><br>
              <button id="for" onclick="rolld20f()" value="1">Força</button>
              <button id="agi" onclick="rolld20a()" value="1">Agilidade</button>
              <button id="int" onclick="rolld20i()" value="1">Intelecto</button>
              <button id="vig" onclick="rolld20v()" value="1">Vigor</button>
              <button id="pre" onclick="rolld20p()" value="1">Presença</button>
              <p id="resultado"></p>
          </div>
        </Section>
        <div id="myModal" class="modal">
            <div class="modal-content">
                <botton class="close">&times;</botton>
                <form onsubmit="return false">
                <label>Dano sofrido:</label>
                <br>
                <input type="number" name="dano_sofrido" id="dano_sofrido">
                <br>
                <label>Cura recebido:</label>
                <br>
                <input type="number" name="cura" id="cura">
                <br>
                <label>Dano mental:</label>
                <br>
                <input type="number" name="dano_mental" id="dano_mental">
                <br>
                <label>Sanidade regenerada:</label>
                <br>
                <input type="number" name="san_regen" id="san_regen">
                <br>
                <label>Pontos de esforço gastos:</label>
                <br>
                <input type="number" name="pe_gasto" id="pe_gasto">
                <br>
                <label>Pontos de esforço recuperados:</label>
                <br>
                <input type="number" name="pe_ganho" id="pe_ganho">
                <br><br>
                <button type="submit" id="submit_personagem" class="buttons-form">Enviar</button>
                </form>
            </div>
        </div>
    </body>
<script>
var modal = document.getElementById("myModal");
var btn = document.getElementById("myBtn");
var button = document.getElementsByClassName("close")[0];
btn.onclick = function() {
  modal.style.display = "block";
}
button.onclick = function() {
  modal.style.display = "none";
}
window.onclick = function(event) {
  if (event.target == modal) {
    modal.style.display = "none";
  }
};
function rolld20f(){
    a = document.getElementById("for").value;
    if (a==0){
        d1 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        d2 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        if (d1<d2){
            dadofinal = d1
        } else{
            dadofinal = d2
        }
        alert('O seu maior dado foi:'+dadofinal);
    };
    if(a>0){
        dadofinal = 0
        for(let x = 0;x < a; x++){
            x = Math.floor(Math.random() * (20 - 1 +1)) + 1
            if (x>a){
                dadofinal=x;
            } else if (dadofinal == 0){
                dadofinal = x;

            }
        }}
    alert('O seu maior dado foi:'+dadofinal);
};
function rolld20a(){
    a = document.getElementById("agi").value;
    if (a==0){
        d1 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        d2 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        if (d1<d2){
            dadofinal = d1
        } else{
            dadofinal = d2
        }
        alert(dadofinal);
    };
    if(a>0){
        dadofinal = 0
        for(let x = 0;x < a; x++){
            x = Math.floor(Math.random() * (20 - 1 +1)) + 1
            if (x>a){
                dadofinal=x;
            } else if (dadofinal == 0){
                dadofinal = x;

            }
        }}
    alert('O seu maior dado foi:'+dadofinal);
};
function rolld20i(){
    a = document.getElementById("int").value;
    if (a==0){
        d1 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        d2 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        if (d1<d2){
            dadofinal = d1
        } else{
            dadofinal = d2
        }
        alert('O seu maior dado foi:'+dadofinal);
    };
    if(a>0){
        dadofinal = 0
        for(let x = 0;x < a; x++){
            x = Math.floor(Math.random() * (20 - 1 +1)) + 1
            if (x>a){
                dadofinal=x;
            } else if (dadofinal == 0){
                dadofinal = x;

            }
        }}
    alert('O seu maior dado foi:'+dadofinal);
};
function rolld20p(){
    a = document.getElementById("pre").value;
    if (a==0){
        d1 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        d2 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        if (d1<d2){
            dadofinal = d1
        } else{
            dadofinal = d2
        }
        alert('O seu maior dado foi:'+dadofinal);
    };
    if(a>0){
        dadofinal = 0
        for(let x = 0;x < a; x++){
            x = Math.floor(Math.random() * (20 - 1 +1)) + 1
            if (x>a){
                dadofinal=x;
            } else if (dadofinal == 0){
                dadofinal = x;

            }
        }}
    alert('O seu maior dado foi:'+dadofinal);
};
function rolld20v(){
    a = document.getElementById("vig").value;
    if (a==0){
        d1 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        d2 = Math.floor(Math.random() * (20 - 1 +1)) + 1
        if (d1<d2){
            dadofinal = d1
        } else{
            dadofinal = d2
        }
        alert('O seu maior dado foi:'+dadofinal);
    };
    if(a>0){
        dadofinal = 0
        for(let x = 0;x < a; x++){
            x = Math.floor(Math.random() * (20 - 1 +1)) + 1
            if (x>a){
                dadofinal=x;
            } else if (dadofinal == 0){
                dadofinal = x;

            }
        }}
    alert('O seu maior dado foi:'+dadofinal);
};
</script>
<script>
meuip = sessionStorage.getItem('meuip')
personagem = sessionStorage.getItem('personagem');
var log =JSON.stringify({id:personagem});
$.ajax({
    url: `http://${meuip}:5000/listar/jogador`,
            type: 'POST',
            dataType: 'json',
            contentType: 'application/json',
            data: log,
            success: sucesso,
            error: anyError
})
function sucesso(retorno){
    document.getElementById("nome").innerHTML = `${retorno.nome}`;
    document.getElementById("vida").innerHTML = `Vida:${retorno.vd}/${retorno.vd_max}`;
    document.getElementById("vida_atual").value = retorno.vd;
    document.getElementById("vida_atual").max = retorno.vd_max;
    document.getElementById("san").innerHTML = `Sanidade:${retorno.san}/${retorno.san_max}`;
    document.getElementById("san_atual").value = retorno.san;
    document.getElementById("san_atual").max = retorno.san_max;
    document.getElementById("pe").innerHTML = `Pontos de Esforço:${retorno.pe}/${retorno.pe_max}`;
    document.getElementById("pe_atual").value = retorno.pe;
    document.getElementById("pe_atual").max = retorno.pe_max;
    document.getElementById("for").value = retorno.forca;
    document.getElementById("agi").value = retorno.agi;
    document.getElementById("int").value = retorno.int;
    document.getElementById("vig").value = retorno.vig;
    document.getElementById("pre").value = retorno.pre;
}
function anyError(retorno){
    alert(retorno.detalhes)
}
</script>
<script src="{{url_for('static',filename='js/update_simples.js')}}" type="text/javascript"></script>
</html>